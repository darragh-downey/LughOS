name: LughOS Static Analysis
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  analysis:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Install dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y cppcheck clang-tidy

      - name: Run static analysis with clang-tidy (CERT C)
        run: |
          clang-tidy "-checks=cert-*" kernel/*.c -- -Iinclude || true

      - name: Run static analysis with Cppcheck
        run: |
          cppcheck --enable=all --suppress=missingIncludeSystem \
            -Iinclude \
            kernel/*.c services/scheduler/*.c services/storage/*.c
